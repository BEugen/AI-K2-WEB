var tmdata=null;var tmstat=[];var achart=null;var astat=null;var limstop=0.95;function getdata(b,a,c){astat=$.ajax({url:b,data:{id:0,csrfmiddlewaretoken:c},timeout:100000,type:"POST",beforeSend:function(){},success:function(d){drawinfo(d,a);tmdata=window.setTimeout(function(){getdata(b,a,c)},10000)},error:function(){tmdata=window.setTimeout(function(){getdata(b,a,c)},10000)}})}function getstat(a,b){$.ajax({url:a,data:{id:0,csrfmiddlewaretoken:b},timeout:300000,type:"POST",beforeSend:function(){},success:function(c){drawstat(c);tmstat=window.setTimeout(function(){getstat(a,b)},108000)},error:function(){tmstat=window.setTimeout(function(){getstat(a,b)},108000)}})}function drawstat(d){var f=[0,0,0,0,0,0];for(var b=0;b<3;b++){var c=0;for(var e=-1;e<5;e++){var a=d[b][e.toString()];if(a!=null){$("#s"+(b+1)+"_"+e).text((a/60).toFixed(2)+"ч.");f[c]+=a}else{$("#s"+(b+1)+"_"+e).text("-")}c+=1}}var c=-1;for(var b=0;b<f.length;b++){if(f[b]!==0){$("#s4_"+c).text((f[b]/60).toFixed(2)+"ч.")}else{$("#s4_"+c).text("-")}c+=1}}function drawdata(c,a){if(c==null){return}$("[id^='line']",a).each(function(){$(this).css("stroke","#595b5d")});$("[id^='circle-']",a).each(function(){$(this).css("stroke","#595b5d");$(this).css("fill-opacity",0)});$("[id^='br']",a).each(function(){$(this).css("display","none")});$("[id^='bcircle-']",a).each(function(){$(this).css("display","none")});$("[id^='cce']",a).each(function(){$(this).css("fill","#747474")});if(c.snnclass!==1){$("#line-0",a).css("stroke","#eaeaea");$("#line-1",a).css("stroke","#eaeaea");$("#circle-0",a).css("stroke","#eaeaea");$("#bcircle-0",a).css("display","inline");if(c.stop<=limstop){$("[id^='cce']",a).each(function(){$(this).css("fill","#32f90a")})}else{return}}const b=$("[id^='br']",a);if(c.full>c.empty&&c.snnclass!==1){b.each(function(){$(this).css("display","inline")})}else{b.each(function(){$(this).css("display","none")})}switch(c.snnclass){case 0:b.each(function(){$(this).css("display","none")});break;case 1:$("#line-6",a).css("stroke","#f20855");$("#circle-4",a).css("stroke","#f20855");$("#bcircle-4",a).css("display","inline");break;case 2:$("#line-3",a).css("stroke","#ff0f3c");$("#circle-1",a).css("stroke","#ff0f3c");$("#bcircle-1",a).css("display","inline");break;case 3:$("#line-4",a).css("stroke","#ef7419");$("#circle-2",a).css("stroke","#ef7419");$("#bcircle-2",a).css("display","inline");break;case 4:$("#line-5",a).css("stroke","#32ff15");$("#circle-3",a).css("stroke","#32ff15");$("#bcircle-3",a).css("display","inline");break;default:break}}function strokew(c,a,b){return(a-c)*b+c}function getdatachart(f,c,e,b,a,d){achart=$.ajax({url:c,data:{id:f,csrfmiddlewaretoken:d},timeout:300000,type:"POST",beforeSend:function(){},success:function(g){if(f<3){$("#c_"+f).text("Смена "+g[1]);$("#s_"+f).text("Смена "+g[1]);g=g[0]}drawchart(f,e,b,g);drawstattable(f,e,g);if(a){tmstat[f]=window.setTimeout(function(){getdatachart(f,c,e,b,a,d)},120000)}},error:function(){tmstat[f]=window.setTimeout(function(){getdatachart(f,c,e,b,a,d)},120000)}})}function drawchart(d,b,a,c){a.yaxes[0]["min"]=0;a.yaxes[0]["max"]=105;if(d<3){a.yaxes[0]["min"]=0;a.yaxes[0]["max"]=105}$.plot("#"+b,[c[0],c[1],c[2],c[3],c[4],c[5]],a)}function drawinfo(b,a){$("#cam").css("background-image","url(data:image/jpeg;base64,"+b.img+")");$("#cam-label").text("Дата "+b.tstamp);if(b.stop>limstop&&b.snnclass!==1){$("#img").css("box-shadow","0 0 40px #759ebf")}else{if(b.full<b.empty&&b.snnclass!==1){$("#img").css("box-shadow","0 0 25px 2px #666d6e")}else{switch(b.snnclass){case 0:$("#img").css("box-shadow","0 0 25px 2px #666d6e");break;case 1:$("#img").css("box-shadow","0 0 25px 2px #f20855");break;case 2:$("#img").css("box-shadow","0 0 25px 2px #ff0f3c");break;case 3:$("#img").css("box-shadow","0 0 25px 2px #ef7419");break;case 4:$("#img").css("box-shadow","0 0 25px 2px #32ff15");break}}}drawdata(b,a)}function drawstattable(g,e,f){var d=e.split("_");for(var c=0;c<f.length;c++){var b=f[c][0];if(b[1]!==null&&b[1]!==0){$("#"+d[0]+"_"+g+"_"+c).text((b[1]).toFixed(2))}else{$("#"+d[0]+"_"+g+"_"+c).text("-")}}}function getDays(){var b=new Date();var a=new Date(b);a.setDate(a.getDate()-1);var e=a.getDate();var d=a.getMonth()+1;d=(d<10?"0":"")+d;var c=a.getFullYear();return e+"."+d+"."+c}function getDaysCurrent(){var b=new Date();var a=new Date(b);a.setDate(a.getDate());var e=a.getDate();var d=a.getMonth()+1;d=(d<10?"0":"")+d;var c=a.getFullYear();return e+"."+d+"."+c}function getDaysStart(){var b=new Date();var a=new Date(b);a.setDate(a.getDate());var e=1;var d=a.getMonth()+1;d=(d<10?"0":"")+d;var c=a.getFullYear();return e+"."+d+"."+c}function gestatdata(d,c,b,e,a){$.ajax({url:d,data:{st:c,en:b,csrfmiddlewaretoken:e},timeout:100000,type:"POST",beforeSend:function(){$("#wait").show()},success:function(f){$("#wait").hide();setstat(f,a)},error:function(){$("#wait").hide()}})}function getstatsesgrdata(b,e,f,d,c,a){$.ajax({url:b,data:{ds:e,de:f,type:d,csrfmiddlewaretoken:c},timeout:600000,type:"POST",beforeSend:function(){$("#wait").show()},success:function(g){$("#wait").hide();grses(g,a)},error:function(){$("#wait").hide()}})}function setstat(d,a){for(var b=0;b<d.length&&b<4;b++){var c="ch_";if(b<3){c+=b}else{c+="all"}var e=d[b];drawstattable(b,c,e);a.yaxes[0]["min"]=0;a.yaxes[0]["max"]=105;$.plot("#"+c,[e[0],e[1],e[2],e[3],e[4],e[5]],a)}}function grses(d,a){for(var b=0;b<d.length&&b<5;b++){var c="ch_"+b;var e=d[b];drawstattable(b,c,e);a.yaxes[0]["min"]=0;a.yaxes[0]["max"]=105;$.plot("#"+c,[e[0],e[1],e[2],e[3],e[4],e[5]],a)}}function getprotocol(a,b,c,d){astat=$.ajax({url:a,data:{dt:c,dr:d,csrfmiddlewaretoken:b},timeout:100000,type:"POST",beforeSend:function(){$("#wait").show()},success:function(e){$("#wait").hide();protocolview(e)},error:function(){$("#wait").hide()}})}function gettrends(a,b,c){astat=$.ajax({url:a,data:{id:c,csrfmiddlewaretoken:b},timeout:100000,type:"POST",beforeSend:function(){$("#wait_"+(c===0?"month":"year")).show()},success:function(d){$("#wait_"+(c===0?"month":"year")).hide();drawtrend(c,d)},error:function(){$("#wait_"+(c===0?"month":"year")).hide()}})}function protocolview(c){$('div[id^="rw"]').remove();for(var a=0;a<c.length;a++){var b="<div id='rw"+a+"' class='prot-row-form'><div id='t"+a+"' class='float-left prot-row-font-form'>"+c[a]["tstamp"]+"</div><div class='float-left prot-row-font-form'>"+c[a]["tfile"]+"</div><div class='float-left prot-row-font-form'><a href='data:image/jpeg;base64,"+c[a]["img"]+"'class='preview' title='Класс: "+snnclass(c[a]["snnclass"])+"'><img class='prot-row-img-form' src='data:image/jpeg;base64,"+c[a]["img"]+"'></a></div><div class='float-left prot-row-font-form'>"+c[a]["stop"].toFixed(2)+"</div><div class='float-left prot-row-font-form'>"+c[a]["empty"].toFixed(2)+"</div><div class='float-left prot-row-font-form'>"+c[a]["full"].toFixed(2)+"</div><div class='float-left prot-row-font-form'>"+c[a]["imerror"].toFixed(2)+"</div><div class='float-left prot-row-font-form'>"+snnclass(c[a]["snnclass"])+"</div><div class='float-left prot-row-font-form'>"+c[a]["snn1"]+"</div><div class='float-left prot-row-font-form'>"+c[a]["snn2"]+"</div><div class='float-left prot-row-font-form'>"+c[a]["snn3"]+"</div></div>";$(b).insertAfter("#hd")}$(".preview").anarchytip()}function snnclass(b){var a={"-1":"простой","0":"без материала","2":"пыль","1":"не распознано","3":"брикеты, мелочь","4":"брикеты"};return a[b.toString()]}function drawtrend(d,b){var a={colors:["#759ebf","#666d6e","#f20855","#ff0f3c","#ef7419","#32ff15","#ff2b00"],xaxis:{mode:"time",timezone:"browser",useLocalTime:true,timeformat:"%d.%m.%y",font:{color:"#efeeef"}},yaxes:[{position:"left",min:0,max:105,color:"#759ebf",font:{color:"#efeeef"}},{position:"left",min:0,max:105,color:"#666d6e"},{position:"left",min:0,max:105,color:"#f20855"},{position:"left",min:0,max:105,color:"#ff0f3c"},{position:"left",min:0,max:105,color:"#ef7419"},{position:"left",min:0,max:105,color:"#32ff15"},{position:"left",min:0,max:105,color:"#ff2b00"}],legend:{position:"ne",backgroundOpacity:0,labelBoxBorderColor:null,margin:0,noColumns:0,show:true,sorted:null},grid:{color:"#eaeaea",hoverable:true}};var c=d===0?"month":"year";$.plot("#ch_"+c,b,a)};