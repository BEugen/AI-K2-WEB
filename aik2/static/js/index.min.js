var tmdata=null,tmstat=[],achart=null,astat=null,limstop=.947;function getdata(a,b,c){astat=$.ajax({url:a,data:{id:0,csrfmiddlewaretoken:c},timeout:1E5,type:"POST",beforeSend:function(){},success:function(d){drawinfo(d,b);tmdata=window.setTimeout(function(){getdata(a,b,c)},1E4)},error:function(){tmdata=window.setTimeout(function(){getdata(a,b,c)},1E4)}})}
function getstat(a,b){$.ajax({url:a,data:{id:0,csrfmiddlewaretoken:b},timeout:3E5,type:"POST",beforeSend:function(){},success:function(c){drawstat(c);tmstat=window.setTimeout(function(){getstat(a,b)},108E3)},error:function(){tmstat=window.setTimeout(function(){getstat(a,b)},108E3)}})}
function drawstat(a){for(var b=[0,0,0,0,0,0],c=0;3>c;c++)for(var d=0,e=-1;5>e;e++){var f=a[c][e.toString()];null!=f?($("#s"+(c+1)+"_"+e).text((f/60).toFixed(2)+"\u0447."),b[d]+=f):$("#s"+(c+1)+"_"+e).text("-");d+=1}a=-1;for(c=0;c<b.length;c++)0!==b[c]?$("#s4_"+a).text((b[c]/60).toFixed(2)+"\u0447."):$("#s4_"+a).text("-"),a+=1}
function drawdata(a,b){if(null!=a){$("[id^='line']",b).each(function(){$(this).css("stroke","#595b5d")});$("[id^='circle-']",b).each(function(){$(this).css("stroke","#595b5d");$(this).css("fill-opacity",0)});$("[id^='br']",b).each(function(){$(this).css("display","none")});$("[id^='bcircle-']",b).each(function(){$(this).css("display","none")});$("[id^='cce']",b).each(function(){$(this).css("fill","#747474")});if(1!==a.snnclass)if($("#line-0",b).css("stroke","#eaeaea"),$("#line-1",b).css("stroke",
"#eaeaea"),$("#circle-0",b).css("stroke","#eaeaea"),$("#bcircle-0",b).css("display","inline"),a.stop<=limstop)$("[id^='cce']",b).each(function(){$(this).css("fill","#32f90a")});else return;var c=$("[id^='br']",b);a.full>a.empty&&1!==a.snnclass?c.each(function(){$(this).css("display","inline")}):c.each(function(){$(this).css("display","none")});switch(a.snnclass){case 0:c.each(function(){$(this).css("display","none")});break;case 1:$("#line-6",b).css("stroke","#f20855");$("#circle-4",b).css("stroke",
"#f20855");$("#bcircle-4",b).css("display","inline");break;case 2:$("#line-3",b).css("stroke","#ff0f3c");$("#circle-1",b).css("stroke","#ff0f3c");$("#bcircle-1",b).css("display","inline");break;case 3:$("#line-4",b).css("stroke","#ef7419");$("#circle-2",b).css("stroke","#ef7419");$("#bcircle-2",b).css("display","inline");break;case 4:$("#line-5",b).css("stroke","#32ff15"),$("#circle-3",b).css("stroke","#32ff15"),$("#bcircle-3",b).css("display","inline")}}}function strokew(a,b,c){return(b-a)*c+a}
function getdatachart(a,b,c,d,e,f){achart=$.ajax({url:b,data:{id:a,csrfmiddlewaretoken:f},timeout:3E5,type:"POST",beforeSend:function(){},success:function(g){3>a&&($("#c_"+a).text("\u0421\u043c\u0435\u043d\u0430 "+g[1]),$("#s_"+a).text("\u0421\u043c\u0435\u043d\u0430 "+g[1]),g=g[0]);drawchart(a,c,d,g);drawstattable(a,c,g);e&&(tmstat[a]=window.setTimeout(function(){getdatachart(a,b,c,d,e,f)},12E4))},error:function(){tmstat[a]=window.setTimeout(function(){getdatachart(a,b,c,d,e,f)},12E4)}})}
function drawchart(a,b,c,d){c.yaxes[0].min=0;c.yaxes[0].max=105;3>a&&(c.yaxes[0].min=0,c.yaxes[0].max=105);$.plot("#"+b,[d[0],d[1],d[2],d[3],d[4],d[5]],c)}
function drawinfo(a,b){$("#cam").css("background-image","url(data:image/jpeg;base64,"+a.img+")");$("#cam-label").text("\u0414\u0430\u0442\u0430 "+a.tstamp);if(a.stop>limstop&&1!==a.snnclass)$("#img").css("box-shadow","0 0 40px #759ebf");else if(a.full<a.empty&&1!==a.snnclass)$("#img").css("box-shadow","0 0 25px 2px #666d6e");else switch(a.snnclass){case 0:$("#img").css("box-shadow","0 0 25px 2px #666d6e");break;case 1:$("#img").css("box-shadow","0 0 25px 2px #f20855");break;case 2:$("#img").css("box-shadow",
"0 0 25px 2px #ff0f3c");break;case 3:$("#img").css("box-shadow","0 0 25px 2px #ef7419");break;case 4:$("#img").css("box-shadow","0 0 25px 2px #32ff15")}drawdata(a,b)}function drawstattable(a,b,c){b=b.split("_");for(var d=0;d<c.length;d++){var e=c[d][0];null!==e[1]&&0!==e[1]?$("#"+b[0]+"_"+a+"_"+d).text(e[1].toFixed(2)):$("#"+b[0]+"_"+a+"_"+d).text("-")}}
function getDays(){var a=new Date(new Date);a.setDate(a.getDate()-1);var b=a.getDate(),c=a.getMonth()+1;c=(10>c?"0":"")+c;a=a.getFullYear();return b+"."+c+"."+a}function gestatdata(a,b,c,d,e){$.ajax({url:a,data:{st:b,en:c,csrfmiddlewaretoken:d},timeout:1E5,type:"POST",beforeSend:function(){$("#wait").show()},success:function(a){$("#wait").hide();setstat(a,e)},error:function(){$("#wait").hide()}})}
function setstat(a,b){for(var c=0;c<a.length&&4>c;c++){var d="ch_";d=3>c?d+c:d+"all";var e=a[c];drawstattable(c,d,e);b.yaxes[0].min=0;b.yaxes[0].max=105;$.plot("#"+d,[e[0],e[1],e[2],e[3],e[4],e[5]],b)}}function getprotocol(a,b,c,d){astat=$.ajax({url:a,data:{dt:c,dr:d,csrfmiddlewaretoken:b},timeout:1E5,type:"POST",beforeSend:function(){$("#wait").show()},success:function(a){$("#wait").hide();protocolview(a)},error:function(){$("#wait").hide()}})}
function gettrends(a,b,c){astat=$.ajax({url:a,data:{id:c,csrfmiddlewaretoken:b},timeout:1E5,type:"POST",beforeSend:function(){$("#wait_"+(0===c?"month":"year")).show()},success:function(a){$("#wait_"+(0===c?"month":"year")).hide();drawtrend(c,a)},error:function(){$("#wait_"+(0===c?"month":"year")).hide()}})}
function protocolview(a){$('div[id^="rw"]').remove();for(var b=0;b<a.length;b++){var c="<div id='rw"+b+"' class='prot-row-form'><div id='t"+b+"' class='float-left prot-row-font-form'>"+a[b].tstamp+"</div><div class='float-left prot-row-font-form'>"+a[b].tfile+"</div><div class='float-left prot-row-font-form'><a href='data:image/jpeg;base64,"+a[b].img+"'class='preview' title='\u041a\u043b\u0430\u0441\u0441: "+snnclass(a[b].snnclass)+"'><img class='prot-row-img-form' src='data:image/jpeg;base64,"+a[b].img+
"'></a></div><div class='float-left prot-row-font-form'>"+a[b].stop.toFixed(2)+"</div><div class='float-left prot-row-font-form'>"+a[b].empty.toFixed(2)+"</div><div class='float-left prot-row-font-form'>"+a[b].full.toFixed(2)+"</div><div class='float-left prot-row-font-form'>"+a[b].imerror.toFixed(2)+"</div><div class='float-left prot-row-font-form'>"+snnclass(a[b].snnclass)+"</div><div class='float-left prot-row-font-form'>"+a[b].snn1+"</div><div class='float-left prot-row-font-form'>"+a[b].snn2+
"</div><div class='float-left prot-row-font-form'>"+a[b].snn3+"</div></div>";$(c).insertAfter("#hd")}$(".preview").anarchytip()}
function snnclass(a){return{"-1":"\u043f\u0440\u043e\u0441\u0442\u043e\u0439",0:"\u0431\u0435\u0437 \u043c\u0430\u0442\u0435\u0440\u0438\u0430\u043b\u0430",2:"\u043f\u044b\u043b\u044c",1:"\u043d\u0435 \u0440\u0430\u0441\u043f\u043e\u0437\u043d\u0430\u043d\u043e",3:"\u0431\u0440\u0438\u043a\u0435\u0442\u044b, \u043c\u0435\u043b\u043e\u0447\u044c",4:"\u0431\u0440\u0438\u043a\u0435\u0442\u044b"}[a.toString()]}
function drawtrend(a,b){$.plot("#ch_"+(0===a?"month":"year"),b,{colors:"#759ebf #666d6e #f20855 #ff0f3c #ef7419 #32ff15".split(" "),xaxis:{mode:"time",timezone:"browser",useLocalTime:!0,timeformat:"%d.%m.%y",font:{color:"#efeeef"}},yaxes:[{position:"left",min:0,max:105,color:"#759ebf",font:{color:"#efeeef"}},{position:"left",min:0,max:105,color:"#666d6e"},{position:"left",min:0,max:105,color:"#f20855"},{position:"left",min:0,max:105,color:"#ff0f3c"},{position:"left",min:0,max:105,color:"#ef7419"},
{position:"left",min:0,max:105,color:"#32ff15"}],legend:{position:"ne",backgroundOpacity:0,labelBoxBorderColor:null,margin:0,noColumns:0,show:!0,sorted:null},grid:{color:"#eaeaea",hoverable:!0}})};
